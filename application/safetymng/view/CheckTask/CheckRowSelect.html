{__NOLAYOUT__}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link id="bs-css" href="__PUBLIC__/css/bootstrap-cerulean.min.css" rel="stylesheet">
    <link href="__PUBLIC__/css/charisma-app.css" rel="stylesheet">
    <link href='__PUBLIC__/bower_components/fullcalendar/dist/fullcalendar.css' rel='stylesheet'>
    <link href='__PUBLIC__/bower_components/fullcalendar/dist/fullcalendar.print.css' rel='stylesheet' media='print'>
    <link href='__PUBLIC__/bower_components/chosen/chosen.min.css' rel='stylesheet'>
    <link href='__PUBLIC__/bower_components/colorbox/example3/colorbox.css' rel='stylesheet'>
    <link href='__PUBLIC__/bower_components/responsive-tables/responsive-tables.css' rel='stylesheet'>
    <link href='__PUBLIC__/bower_components/bootstrap-tour/build/css/bootstrap-tour.min.css' rel='stylesheet'>
    <link href='__PUBLIC__/css/jquery.noty.css' rel='stylesheet'>
    <link href='__PUBLIC__/css/noty_theme_default.css' rel='stylesheet'>
    <link href='__PUBLIC__/css/elfinder.min.css' rel='stylesheet'>
    <link href='__PUBLIC__/css/elfinder.theme.css' rel='stylesheet'>
    <link href='__PUBLIC__/css/jquery.iphone.toggle.css' rel='stylesheet'>
    <link href='__PUBLIC__/css/uploadify.css' rel='stylesheet'>
    <link href='__PUBLIC__/css/animate.min.css' rel='stylesheet'>
    <link href='__PUBLIC__/css/doc.min.css' rel='stylesheet'>
    <link href='__PUBLIC__/css/MyCss.css' rel='stylesheet'>
    <link href='__PUBLIC__/css/jquery-ui.min.css' rel='stylesheet'>

    <link href="__PUBLIC__/css/bootstrap-table.css" rel="stylesheet">
    <link href="__PUBLIC__/css/zTreeStyle/zTreeStyle.css" rel="stylesheet">
    <link href="__PUBLIC__/css/bootstrap-editable.css" rel="stylesheet">
    <link href="__PUBLIC__/css/ui-dialog.css" rel="stylesheet">
    <!-- jQuery -->
    <script src="__PUBLIC__/js/jquery.js"></script>
    <script src="__PUBLIC__/js//bootstrap.js"></script>

    <!-- include summernote css/js -->
    <link href="__PUBLIC__/css/summernote.css" rel="stylesheet">
    <script src="__PUBLIC__/js/summernote.js"></script>

    <!-- library for cookie management -->
    <script src="__PUBLIC__/js/jquery.cookie.js"></script>
    <!-- calender plugin -->

    <!-- data table plugin -->
    <script src='__PUBLIC__/js/jquery.dataTables.min.js'></script>

    <!-- select or dropdown enhancer -->
    <script src="__PUBLIC__/bower_components/chosen/chosen.jquery.min.js"></script>
    <!-- plugin for gallery image view -->
    <script src="__PUBLIC__/bower_components/colorbox/jquery.colorbox-min.js"></script>
    <!-- notification plugin -->
    <script src="__PUBLIC__/js/jquery.noty.js"></script>
    <!-- library for making tables responsive -->
    <script src="__PUBLIC__/bower_components/responsive-tables/responsive-tables.js"></script>
    <!-- tour plugin -->
    <script src="__PUBLIC__/bower_components/bootstrap-tour/build/js/bootstrap-tour.min.js"></script>
    <!-- star rating plugin -->
    <!-- for iOS style toggle switch -->
    <!-- autogrowing textarea plugin -->
    <script src="__PUBLIC__/js/jquery.autogrow-textarea.js"></script>
    <!-- multiple file upload plugin -->
    <script src="__PUBLIC__/js/jquery.uploadify-3.1.min.js"></script>
    <script src="__PUBLIC__/js/gyComm.js"></script>
    <script src="__PUBLIC__/js/jquery-ui.min.js"></script>
    <script src="__PUBLIC__/js/gyComm.js"></script>
    <script src="__PUBLIC__/js//bootstrap-slider.min.js"></script>
    <link href="__PUBLIC__/css/select2.min.css" rel="stylesheet" />
    <script src="__PUBLIC__/js/select2.min.js"></script>
    <link href="__PUBLIC__/css/bootstrap-datetimepicker.css" rel="stylesheet">
    <script src="__PUBLIC__/js/dialog-plus-min.js"></script>
    <script type="text/javascript" src="__PUBLIC__/js/jquery.treegrid.js"></script>
    <link rel="stylesheet" href="__PUBLIC__/css/jquery.treegrid.css">
    <script type="text/javascript" charset="utf-8" src="__PUBLIC__/UEditor/ueditor.config.js"> </script>
    <script type="text/javascript" charset="utf-8" src="__PUBLIC__/UEditor/ueditor.all.js"> </script>
    <script type="text/javascript" charset="utf-8" src="__PUBLIC__/UEditor/lang/zh-cn/zh-cn.js"></script>
    <script src="__PUBLIC__/js/GY.js"></script>
    <link href="__PUBLIC__/css/dialog.css" rel="stylesheet">
    <script src="__PUBLIC__/js/dialog-plus.js"></script>
    <script src="__PUBLIC__/layer/layer.js"></script>
    <script src="__PUBLIC__/js/GY.js"></script>
    <STYLE>
        .select2-container .select2-selection--single{
            height:34px;
            line-height: 34px;
        }
        .xuxian{
            height:0;
            border-bottom:#000000 2px dashed;
        }
    </STYLE>
</head>
<body class="container-full">
<form action="/SafetyMng/CheckTask/CheckRowQuery/CheckListID/{$CheckListID}" method="post" enctype="application/x-www-form-urlencoded">
    <datalist id="CorpList">
        {volist name="CorpList" id="v"}
            <option value="{$v.Corp}">{$v.id}</option>
        {/volist}
    </datalist>
    <input type="hidden" id="opType" name="opType" value=""/>
    <input type="hidden" id="CurRowId" name="CurRowId" value="0"/>
    {php}
        $CTBMng = new app\safetymng\controller\CheckTBMng();
    {/php}
    <div style="width: 96%;margin-left: 2%;" >
        <div class="row">
            <table class="table table-bordered col-sm-11">
                <tr>
                    <td style="width: 10%;"><span style="font-weight: bold;">数据库:</span></td>
                    <td style="width: 20%">
                        <select class="form-control required"  name="CheckDB" id="CheckDB" LinkAge>
                            <option></option>
                            {volist name="CheckDB" id="vo"}
                                <option value="{$vo.id}" {eq name="Think.post.CheckDB1" value="{$vo.id}"} selected {/eq}>{$vo.BaseName}</option>
                            {/volist}
                        </select>
                    </td>
                    <td style="width: 13%">
                        <span style="font-weight: bold;">专业名称:</span>
                    </td>
                    <td style="width: 20%">
                        <select class="form-control required"  data-tags="true" name="ProfessionName" id="ProfessionName" LinkAge>
                            <option></option>
                            <option value="{php}echo $CTBMng->RMInputPre(input('ProfessionName'));{/php}" selected>{php}echo $CTBMng->RMInputPre(input('ProfessionName'));{/php}</option>
                        </select>
                    </td>
                    <td style="width: 10%">
                        <span style="font-weight: bold;">业务名称:</span>
                    </td>
                    <td style="width: 10%" colspan="3">
                        <select class="form-control required" data-tags="true"  name="BusinessName" id="BusinessName" LinkAge>
                            <option></option>
                            <option value="{php}echo $CTBMng->RMInputPre(input('BusinessName'));{/php}" selected>{php}echo $CTBMng->RMInputPre(input('BusinessName'));{/php}</option>
                        </select>
                    </td>

                </tr>
                <tr>
                    <div class="row">


                        <td >
                            <span style="font-weight: bold;">检查来源:</span>
                        </td>
                        <td colspan="">
                            <select class="form-control required" data-tags="true" name="CheckSource"  id="CheckSource" LinkAge>
                                <option></option>
                                <option>{php}echo $CTBMng->RMInputPre(input('CheckSource'));{/php}</option>
                            </select>
                        </td>
                        <td><span style="font-weight: bold;">检查项目:</span></td>
                        <td colspan="">
                            <select class="form-control required" data-tags="true" name="CheckSubject" id="CheckSubject" LinkAge>
                                <option></option>
                                <option value="{php}echo $CTBMng->RMInputPre(input('CheckSubject'));{/php}" selected>{php}echo $CTBMng->RMInputPre(input('CheckSubject'));{/php}</option>
                            </select>
                        </td>
                        <td><span style="font-weight: bold;">检查标准编号:</span></td>
                        <td >
                            <select class="form-control required"  data-tags="true" name="Code1"  id="Code1" LinkAge>
                                <option></option>
                                <option value="{php}echo $CTBMng->RMInputPre(input('Code1'));{/php}" selected>{php}echo $CTBMng->RMInputPre(input('Code1'));{/php}</option>
                            </select>
                        </td>


                    </div >
                </tr>
                <tr>

                    <td ><span style="font-weight: bold;">检查内容:</span></td>
                    <td >
                        <select class="form-control required" data-tags="true" name="CheckContent" id="CheckContent" LinkAge>
                            <option value="{php}echo $CTBMng->RMInputPre(input('CheckContent'));{/php}" selected>{php}echo $CTBMng->RMInputPre(input('CheckContent'));{/php}</option>
                        </select>
                    </td>
                    <td><span style="font-weight: bold;">判定标准编号:</span></td>
                    <td colspan="" style="width: 10%">
                        <select class="form-control required"  data-tags="true" name="Code2"  id="Code2" LinkAge>
                            <option></option>
                            <option value="{php}echo $CTBMng->RMInputPre(input('Code2'));{/php}" selected>{php}echo $CTBMng->RMInputPre(input('Code2'));{/php}</option>
                        </select>
                    </td>



                </tr>
                <tr>
                    <td><span style="font-weight: bold;">适用部门:</span></td>
                    <td >
                        <input class="form-control" name="DutyCorp2" id="DutyCorp2"  value="{$CheckListInfo['DutyCorp']}" readonly/>
                    </td>
                    <td colspan="2" >
                        <div class="row">
                            <div class="col-sm-1" style="width: 20px;">
                                <span style="font-weight: bolder">自</span>
                            </div>
                            <div class="col-sm-10" style="width: 180px;">
                                <input type="date" name="StartDate" value="{$Think.post.StartDate}" class="form-control"/>
                            </div>
                            <div class="col-sm-1" style="width: 20px;">
                                <span style="font-weight: bolder">后</span>
                            </div>
                        </div>

                    </td>
                    <td colspan="3">
                        <select name="ItemCheckType" value="{$Think.post.ItemCheckType}" class="form-control">
                            <option></option>
                            <option {eq name="$Think.post.ItemCheckType" value="未被检查的条款"} selected {/eq}>未被检查的条款</option>
                            <option {eq name="$Think.post.ItemCheckType" value="尚未被检查但已列入检查计划的条款"} selected {/eq}>尚未被检查但已列入检查计划的条款</option>
                            <option {eq name="$Think.post.ItemCheckType" value="尚未被检查且未列入检查计划的条款"} selected {/eq}>尚未被检查且未列入检查计划的条款</option>
                            <option {eq name="$Think.post.ItemCheckType" value="已被检查的条款"} selected {/eq}>已被检查的条款</option>
                        </select>
                    </td>
                    <td>
                        <button type="submit"  class="btn btn-success">查询</button>
                    </td>
                </tr>
                <tr>


                </tr>
            </table>
        </div>
        <div class="row " style="margin-top: 15px;">
            <div class="col-sm-12 xuxian"></div>
        </div>
        <div class="row" style="margin-top: 15px;">
            <div class="col-sm-12" >
                <div id = "gyDiv" style="overflow:scroll; width:100%;">
                    <table class="table table-bordered bootstrap-datatable datatable table-hover responsive" style="width: 100%">
                        <thead>
                        <tr>
                            <th style="width: 50px;">序号</th>
                            <th style="width: 400px;">检查标准</th>
                            <th style="width: 300px;">符合性验证标准<span>&nbsp;&nbsp;&nbsp;&nbsp;<input id="SELAll"  SELAll type="checkbox"/>全选</span>&nbsp;&nbsp;&nbsp;&nbsp;<span><input  DeSELAll id="DeSELAll" type="checkbox"/>全不选</span> <a AddCheckRow class="btn btn-sm btn-warning">+</a></th><!-- 生成类型 航空公司　起点　终点　航班类型--->
                        </thead>
                        <tbody >
                        {volist name="CheckRowList" id="vo"}
                        <tr CheckStandardID = "{$vo.CheckStandardID}" rowId = "{$vo.id}" CKId = "CK{++$Cnt}" >
                            <td CheckStandardTDID = "{$vo.CheckStandardID}">
                               <input id="CK{$Cnt}" type="checkbox" SelCkBox FHID = "{$vo.FHId}" SHID = "{$vo.id}" BaseDBID="{$vo.BaseDBID}" CKListRowId = "{$vo.CheckListRowId}" {neq name="vo.CheckListRowId" value=""}checked="checked"{/neq} />
                                {++$TKCnt}
                            </td>
                            <td>
                                <div class="row">
                                    <div class="col-sm-4">
                                        <span style="font-weight: bolder">检查标准编号:</span>
                                        <label class="label label-warning">{$vo.Code1}</label>
                                    </div>
                                    <div class="col-sm-4">
                                        <span style="font-weight: bolder">专业名称:</span>
                                        <label class="label label-default">{$vo.ProfessionName}</label>
                                    </div>
                                    <div class="col-sm-4">
                                        <span style="font-weight: bolder">业务名称:</span>
                                        {$vo.BusinessName}
                                    </div>
                                </div>
                                <p></p>
                                <div class="row">
                                    <div class="col-sm-4">
                                        <span style="font-weight: bolder">检查来源:</span>
                                        <label class="label label-default">{$vo.CheckSource}</label>

                                    </div>
                                    <div class="col-sm-4">
                                        <span style="font-weight: bolder">检查项目:</span>
                                        {$vo.CheckSubject}

                                    </div>
                                    <div class="col-sm-4">
                                        <span style="font-weight: bolder">检查内容:</span>
                                        {$vo.CheckContent}

                                    </div>
                                </div>
                                <p></p>
                                <div class="row">
                                    <div class="col-sm-12">
                                        <span style="font-weight: bolder">检查标准:</span>
                                        <span style="color: #1b961b;">{$vo.CheckStandard}</span>

                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class="row">
                                    <div class="col-sm-4">
                                        <span style="font-weight: bolder">判定标准编号:</span>
                                        <label class="label label-info">{$vo.Code2}</label>
                                    </div>
                                    <div class="col-sm-4">
                                        <span style="font-weight: bolder">检查方法:</span>{$vo.CheckMethods}
                                    </div>
                                    <div class="col-sm-4">
                                        <span style="font-weight: bolder">检查频次:</span>{$vo.CheckFrequency}
                                    </div>
                                </div>
                                <p></p>
                                <div class="row">
                                    <div class="col-sm-4">
                                        <span style="font-weight: bolder">依据名称:</span>{$vo.BasisName}
                                    </div>
                                    <div class="col-sm-4">
                                        <span style="font-weight: bolder">依据条款:</span>{$vo.BasisTerm}
                                    </div>
                                    <div class="col-sm-4">
                                        <span style="font-weight: bolder">单位手册:</span>{$vo.InnerManual}
                                    </div>
                                </div>
                                <p></p>
                                <div class="row">
                                    <div class="col-sm-12">
                                        <span style="font-weight: bolder">判定标准:</span>
                                        <span style="color: #003eff;"> {$vo.ComplianceStandard}</span>

                                    </div>
                                </div>
                                <p></p>
                                <div class="row">
                                    <div class="col-sm-12">
                                        <span style="font-weight: bolder">适用部门:</span>
                                        {volist name="vo.Corps" id="vv"}
                                        <label class="label label-success">{$vv.Corp}</label>
                                        {/volist}
                                    </div>
                                </div>
                            </td>
                        </tr>
                        {/volist}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <input type="hidden" name="RowSeled" value=""/>
    <input type="hidden" name="CheckTaskID" value="{$CheckListID}"/>
</form>
</body>
<script>
    $CheckListId = {$CheckListID};
    function FillAllSelectById ($id) {
        $.ajax({
            url:"/SafetyMng/Help/GetFirstHalfCheckTBRowById/id/"+$id,
            type:'get',
            dataType:"json",
            success:function (data,textStatus) {
                if(data==null){
                    layer.alert('获取数据失败!');
                    return;
                }
                $('#ProfessionName').select2({data:[{'text':data.ProfessionName,'id':data.ProfessionName}]});
                $('#ProfessionName').val(data.ProfessionName).trigger('change');

                $('#BusinessName').select2({data:[{'text':data.BusinessName,'id':data.BusinessName}]});
                $('#BusinessName').val(data.BusinessName).trigger('change');

                $('#CheckSubject').select2({data:[{'text':data.CheckSubject,'id':data.CheckSubject}]});
                $('#CheckSubject').val(data.CheckSubject).trigger('change');

                $('#Code1').select2({data:[{'text':data.Code1,'id':data.Code1}]});
                $('#Code1').val(data.Code1).trigger('change');

                $('#Code2').select2({data:[{'text':data.Code2,'id':data.Code2}]});
                $('#Code2').val(data.Code2).trigger('change');

                $('#CheckContent').select2({data:[{'text':data.CheckContent,'id':data.CheckContent}]});
                $('#CheckContent').val(data.CheckContent).trigger('change');

                $('#CheckStandard').select2({data:[{'text':data.CheckStandard,'id':data.CheckStandard}]});
                $('#CheckStandard').val(data.CheckStandard).trigger('change');

                $('#CheckDB').val(data.CheckDBId).trigger('change');

                $('#CheckStandardEdit').text(data.CheckStandard);

            },
            error:function (XMLHttpRequest,textStatus,errorThrown) {

            }
        });
    }

    function SelectLinkage (SelID) {
        $Pv = [];
        $SelArr = ['CheckDB','ProfessionName','BusinessName','CheckSource','CheckSubject','Code1','CheckContent','CheckStandard'];
        $SelArr.forEach(function (v) {
            $r = {'SelName':v,'SelText':$('#'+v + ' option:selected').text(),'SelVal':$('#'+v).val()};
            $Pv.push($r);
        });
        $PostData = {"EventSel":SelID,'data':$Pv,'FakeID':'YES','FakeCheckStandardID':''};
        $.ajax({
            url:"/SafetyMng/Help/Ajax_SelectLinkage",
            data: JSON.stringify($PostData),
            type:'post',
            dataType:"json",
            success:function (data,textStatus) {
                $TargetSel = data['TargetSel'];
                $SelData = data['data'];
                //alert($TargetSel);
                $bBegin = false;
                $SelArr.forEach(function (v) {
                    if($bBegin){
                        $('#'+v).html('').select2('data', null);
                    }
                    if(v==SelID){
                        $bBegin =true;
                    }
                });
                $('#'+$TargetSel).select2({data:$SelData});
                $('#'+$TargetSel).val('').select2();
            },
            error:function (XMLHttpRequest,textStatus,errorThrown) {

            }
        });
    }
    $RelatedCorps = {$RelatedCorps|default=[]};
    $(function () {
        $('select').select2();

        $('select[LinkAge]').on("change", function(e) {
            $val  = $(this).val();
            $text = $('#'+$(this).attr('id') + ' option:selected').text();
            if($val!='' && ($text ==$val)){

            }else{
                SelectLinkage($(this).attr('id'))
            }
            $('#RelatedCorps').val($RelatedCorps).change();
         });

        SelectLinkage('CheckDB');

        $('a[AddCheckRow]').click(function () {
           $Cks =  $('input[SelCkBox]:checked');
           $Arr = [];
            $Cks.each(function () {
                $o = {'CheckListId':$CheckListId,'CkId':$(this).attr('id'),'FHID':$(this).attr('FHID'),'BaseDBID':$(this).attr('BaseDBID'),'SHID':$(this).attr('SHID'),'CKListRowId':$(this).attr('CKListRowId')};
                $Arr.push($o);
            });

            $.ajax({
                url:"/SafetyMng/Help/Ajax_AddRowToCheckList",
                data: JSON.stringify($Arr),
                type:'post',
                dataType:"json",
                success:function (data,textStatus) {
                    if(data['Ret']!='Success'){
                        layer.alert('部分条款添加失败!');
                    }
                    $Btn = $('a[AddCheckRow]');
                    $Btn.toggleClass('btn-warning');
                    $Btn.toggleClass('btn-success');
                    $Btn.attr('disabled','disabled');
                    $Btn.text('已添加');
                },
                error:function (XMLHttpRequest,textStatus,errorThrown) {
                    window.location.reload();
                }
            });
        });

        $('tr[CheckStandardID]').dblclick(function () {
            $CkId = $(this).attr('CkId');
            $('a[AddCheckRow]').text('+');
            $Btn = $('a[AddCheckRow]');
            if($Btn.hasClass('btn-success')){
                $Btn.toggleClass('btn-warning');
                $Btn.toggleClass('btn-success');
                $Btn.removeAttr('disabled');
                $Btn.text('+');
            }

            if ($('#'+$CkId).is(':checked')) {
                $('#'+$CkId).removeAttr('checked');
                $('#'+$CkId).parent().css('background-color','white');
            }else{
                $('#'+$CkId).attr('checked','checked');
                $('#'+$CkId).parent().css('background-color','yellow');
            }
        });

        $("#RelatedCorps").select2({"disabled":true});

        $('#DeSELAll').click(
            function () {
                if($(this).is(':checked')){
                    $('input[SelCkBox]').removeAttr('checked');
                    $('input[SELAll]').removeAttr('checked');
                }else{
                    $('input[SelCkBox]').attr('checked','checked');
                }
            }
        );

        $('#SELAll').click(
            function () {
                if($(this).is(':checked')) {
                    $('input[SelCkBox]').attr('checked','checked');
                    $('input[DeSELAll]').removeAttr('checked');
                }else{
                    $('input[SelCkBox]').removeAttr('checked');
                }
            }
        );
        //alert($('input[checkbox]').length);
    });
</script>
</html>